<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{page.title.account}">Personal Account</title>
    <th:block th:insert="~{layout :: head}"></th:block>
</head>
<body>
<div th:replace="~{layout :: header}"></div>
<main class="container mt-4">
    <h1 class="mb-4" th:text="#{page.title.account}">Personal Account</h1>
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header"><h3 th:text="#{section.title.user_info}">User Information</h3></div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong th:text="#{label.email} + ':'">Username:</strong> <span th:text="${user.username}"></span></li>
                        <li class="list-group-item"><strong th:text="#{label.phone_number} + ':'">Phone Number:</strong> <span th:text="${user.phoneNumber}"></span></li>
                        <li class="list-group-item"><strong th:text="#{label.balance} + ':'">Balance:</strong> <span th:text="${#numbers.formatCurrency(user.balance)}"></span> <a th:href="@{/account/deposit}" class="btn btn-sm btn-outline-success float-end" th:text="#{button.top_up}">Top up</a></li>
                        <li class="list-group-item"><strong th:text="#{label.role} + ':'">Role:</strong> <span th:text="${user.role}"></span></li>
                        <li class="list-group-item"><strong th:text="#{label.status} + ':'">Status:</strong> <span class="badge" th:classappend="${user.active} ? 'bg-success' : 'bg-danger'" th:text="${user.active} ? #{status.active} : #{status.blocked}"></span></li>
                    </ul>
                    <div class="mt-3"><a th:href="@{/account/edit}" class="btn btn-primary" th:text="#{button.edit} + ' ' + #{section.title.profile_info}">Edit Profile</a></div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <h3 th:text="#{section.title.my_tours}">My Ordered Tours</h3>
            <div th:if="${#lists.isEmpty(user.vouchers)}" class="alert alert-info" th:text="#{message.info.no_ordered_tours}">You have not ordered any tours yet.</div>
            <div th:if="${!#lists.isEmpty(user.vouchers)}">
                <div class="list-group">
                    <div th:each="voucher : ${user.vouchers}" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1" th:text="${voucher.title}">Voucher Title</h5>
                            <small th:text="${#temporals.format(voucher.arrivalDate, 'dd MMM yyyy')}">Date</small>
                        </div>
                        <p class="mb-1" th:text="${voucher.description}">Description</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted" th:text="#{tour.price} + ': ' + ${#numbers.formatCurrency(voucher.price)}"></small>
                            <span class="badge" th:classappend="${voucher.status.name() == 'PAID'} ? 'bg-success' : (${voucher.status.name() == 'CANCELED'} ? 'bg-danger' : 'bg-warning')" th:text="#{${'voucher.status.' + #strings.toLowerCase(voucher.status.name())}}">Status</span>
                        </div>
                        <form th:if="${voucher.status.name() != 'CANCELED'}" th:action="@{/account/vouchers/{id}/cancel(id=${voucher.id})}" method="post">
                            <button type="submit" class="btn btn-sm btn-danger" th:text="#{button.cancel}">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<div th:replace="~{layout :: footer}"></div>
</body>
</html>